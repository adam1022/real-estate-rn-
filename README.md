# Toor-App

### Setup on OS X

[Install yarn and Homebrew](https://github.com/Utility-NYC/Toor-App.git)

[Install Watchman](https://facebook.github.io/watchman/docs/install.html)

[Install react-native-cli](https://www.npmjs.com/package/react-native-cli)

[Install Carthage (required for BLE-PLX module)](https://github.com/Carthage/Carthage)

Open Terminal; run these commands, each followed by Return / Enter

```git clone https://github.com/Utility-NYC/Toor-App.git```

```cd Toor-App```

```rm yarn.lock```

```yarn install```

```react-native link```

```yarn killwatch```

```react-native run-ios```

### Having Trouble?

If you're getting a babel error, try the following:

1. Keep Simulator open.
2. Close the app: hold ```Cmd + Shift``` and tap ```H``` twice -- quickly -- to simulate a double-tap of the iPhone home button.
3. Swipe up to close app.
4. Kill the packager server in Terminal (control + c)
5. ```yarn start```
6. When it says ```Loading dependency graph, done.```, open the Toor app in Simulator.
7. Simulator should load the bundle properly generated by the packager.

#### BleModule not found

If you're getting an error saying "BleModule not found", try the following:

1. Uninstall a dependency (any dependency), then add it back.
Ex: ```yarn remove axios```

After that step, the BLE module will build, which will take a few minutes.

2. Run: ```yarn add axios``` or whichever module you removed in #1 above, and run ```react-native run-ios``` from the command line, or build in XCode.

### Navigation

To jump to wherever you want in the app upon loading, here's the Navigation flow:

Navigation >> HomeNavigation >> ProfileNavigation

Each "Navigator" has its own set of screens from which to choose. For example, Navigation has Login, EnterLogin, SignUp, ForgotPassword, etc.

At the bottom of each Navigator file, there's an object passed as the second argument. It has a property, "initialRouteName", which can be set to whichever route you choose to be loaded first when that Navigator is activated.

For example, take the following configuration:

Navigation: initialRouteName: "Home"
HomeNavigation: initialRouteName: "Profile"
ProfileNavigation: initialRouteName: "AddLockbox"

Upon loading the app's bundle, you'd arrive at the "AddLockbox" screen.

### Persisted State

One thing to note is the app's persisted state, which is handled through (on iOS) AsyncStorage. This is actually taken care of by the module, ```redux-persist```, as Redux is the state management tool being used.

In App.js, there's a const at the top called PURGE. Appropriately named, set PURGE to ```true``` if you want to completely reset the app's state.

In NavReducer.js, the initial route can be set to any of the routes in Navigation.js except for "Home".

RECOMMENDED:

* set PURGE to false
* login correctly
* program the screen you want to arrive at

Onboarding requires an id / auth token to proceed. The recommended way above only needs to be done once; every successive app reload will persist your logged-in state and navigate immediately to where you program.
